# Анализ оттока клиентов магазина, их покупательской способности и способов удержания

<br/>
<table>
    <tr>
        <td><b>Название проекта (+ссылка)</b></td>
        <td><b>Тема проекта и задача проекта</b></td>
        <td><b>Используемые инструменты</b></td>
        <td><b>Темы инф. материалов и рекомендации ревьювера</b></td>
    </tr>
    <tr>
        <td><a href="https://github.com/DinoWithPython/ds_practicum_projects/blob/main/learning_projects/Отток%20клиентов%20магазина%20%22В%20один%20клик%22/05%20Обучение%20с%20учителем.ipynb" target="_blank"><b>"Обучение с учителем: качество модели"</b></a></td>
        <td><b>Прогноз оттока клиентов магазина.</b> Разработать решение, которое позволит персонализировать предложения постоянным клиентам, чтобы увеличить их покупательскую активность.</td>
        <td><b>ColumnTransformer, SimpleImputer, KNeighborsClassifier, LogisticRegression, RandomizedSearchCV, MinMaxScaler, OneHotEncoder, OrdinalEncoder, StandardScaler, SVC, DecisionTreeClassifier, shap</b></td>
        <td>Подробный разбор метрики ROC AUC, учебник по машинному обучению.</td>
    </tr>
</table>

## Общий вывод и рекомендации заказчику
В рамках выполнения проекта мне было необходимо:
1. Построить модель, которая предскажет вероятность снижения покупательской активности клиента в следующие три месяца.
1. В исследование включу дополнительные данные финансового департамента о прибыльности клиента: какой доход каждый покупатель приносил компании за последние три месяца.
1. Используя данные модели и данные о прибыльности клиентов, выделю сегменты покупателей и разработаю для них персонализированные предложения.
    
При предобработке данных был обнаружен один покупатель, принесший аномальную выручку за месяц в 106 тысяч, при среднем значении выручки в 5 тысяч. В остальном данные были чистые.

По результатам исследовательского анализа можно сделать следующие выводы:
* покупательская активность снизилась прмиено у 60% клиентов;
* около 30% клиентов пользуются премиум сервисом;
* можно выделить две группы пользователей, которые купив вещь с небольшой скидкой, больше ничего не покупают, и те, кто ждет максимальной скидки;
* группа клиентов со снижением активности на сайте ждет какой-то конкретный товар и скидку на него;
* категория пользователей у которых снизился уровень активности, меньше просматривают страницы за визит, чаще покупали товары по привлекательным акциям, больше товаров оставляли с корзине неоплаченными, сильно на это влияют акционные покупки, количество просмотренных категорий. Получается, что покупатель ждал скидку или акцию на какой-то конкретный товар и после покупки такового был менее заинтересовал в дальнейших покупках.

После исследовательского анализа принял решение анализировать покупательскую активность клиентов за 3 месяца, поскольку этого периода достаточно, чтобы сделать основные выводы и сосредоточиться на удержании текущих клиентов. Выделив желаемый период, объединяю фреймы в один для обучения модели. Затем при помощи матрицы корреляции и даграмы рассеянья был проведен анализ, при котором принято решение оставить все признаки, заметная линейная зависимость между выручкой текущего и предыдущего месяца. Акционные покупки вполне делятся не несколько групп. Маркет_актив_тек_месяца может уйти в категориальный признак. У прочих признаков значения распределены довольно равномерно.

В качестве метрики: Одной из целей проекта является маркировка финансовой активности клиентов. При этом нужно охватить всех клиентов без выделения интересов в плане снизилась активность или возросла. Поэтому использование precision или recall и максимизация одного из них не подойдёт. Можно предположить, что подойдёт accuracy, ведь важна точность предсказаний модели, но нет - она не учитывает соотношения ложных срабатываний модели. Если человек покупает много, а мы определяем его как того, кто покупал мало и начинаем заваливать предложениями, то получится не очень хорошо. Поэтому буду использовать метрику roc_auc - как компромисс между количеством положительно определенной активности клиентов и количеством неправильно положительно определенной активности клиентов.

В качестве основной модели для предсказания при помощи `RandomizedSearchCV` выбрана `LogisticRegression`(C=4, penalty='l1', random_state=4241,solver='liblinear'). Модель показала хорошие рузультаты 0,91 на обучающей и 0.89 на тестовой выборке. Модель обучалась на следующих признаках:
* `тип_сервиса` — уровень сервиса, например «премиум» и «стандарт».;
* `разрешить_сообщать` — информация о том, можно ли присылать покупателю дополнительные предложения о товаре. Согласие на это даёт покупатель;
* `маркет_актив_6_мес` — среднемесячное значение маркетинговых коммуникаций компании, которое приходилось на покупателя за последние 6 месяцев. Это значение показывает, какое число рассылок, звонков, показов рекламы и прочего приходилось на клиента;
* `маркет_актив_тек_мес` — количество маркетинговых коммуникаций в текущем месяце;
* `длительность` — значение, которое показывает, сколько дней прошло с момента регистрации покупателя на сайте;
* `акционные_покупки` — среднемесячная доля покупок по акции от общего числа покупок за последние 6 месяцев;
* `популярная_категория` — самая популярная категория товаров у покупателя за последние 6 месяцев;
* `средний_просмотр_категорий_за_визит` — показывает, сколько в среднем категорий покупатель просмотрел за визит в течение последнего месяца;
* `неоплаченные_продукты_штук_квартал` — общее число неоплаченных товаров в корзине за последние 3 месяца;
* `ошибка_сервиса` — число сбоев, которые коснулись покупателя во время посещения сайта;
* `страниц_за_визит` — среднее количество страниц, которые просмотрел покупатель за один визит на сайт за последние 3 месяца;
* `предыдущий_месяц_выручка` — по наименованию столбца сформированная выручка за предыдущий месяц;
* `препредыдущий_месяц_выручка` — по наименованию столбца сформированная выручка за предпреыдущий месяц;
* `текущий_месяц_выручка` — по наименованию столбца сформированная выручка за текущий месяц;
* `предыдущий_месяц_минут` — по наименованию столбца сколько минут пользователь провел на сайте за предыдущий месяц;
* `текущий_месяц_минут` — по наименованию столбца сколько минут пользователь провел на сайте за текущий месяц;

**Выводы о значимости признаков.**

Наиболее важные для модели признаки:
* количество страниц за визит;
* средний просмотр категорий за визит;
* определенные категории;
* акционные покупки.

Наименее важные признаки для модели:
* выручки предыдущего и текущего месяца;
* ошибки сервиса;
* длительность пребывания и ошибки.

При принятии решений для бизнеса следует руководствоваться:
* чем больше пользователь совершает действий на сайте, просматривает категорий, тем меньше вероятность снижения активности пользователя;
* если пользователя интересуют определенные товары, то при появлении акций на них снизится и вероятность дальнейшей активности пользователя;
* чем больше пользователь добавляет товаров в корзину и не оплачивает их, тем больше вероятность снижения его активноности, что скорее всего обусловлено покупкой аналогичных товаров у конкурентов(возможно имеет смысл напоминание о забытых товарах в корзине);
* акционные мероприятия так же соразмерно влияют на покупательскую активность

Рекомендации для бизнеса:
* выслать категории без подписки предложения о таковой, что может повысить нашу выручку с этого, а покупателем позволит покупать товары более выгодно и получать информацию об акциях и скидках раньше других пользователей;
* можно провести рекламную компанию на наиболее популярные категории в течение следующих нескольких месяцев, что может увеличить объем продаж, либо сосредоточиться на наименее популярных категоряих и рекламы товаров этой категории - ожидая, что это послужит напоминанием пользователем о покупках, которые они хотели сделать, но не сделали;
* если реализовано отслеживание определенных категорий товаров, то отдельно для пользователей, которые интересовались определенными категорями высылать отдельную рекламную рассылку по таким товарам.
 
    
#### 📖 **Полезные ссылки**

* [Подробное описание метрики ROC AUC](https://alexanderdyakonov.wordpress.com/2017/07/28/auc-roc-площадь-под-кривой-ошибок/)

#### Книги
* [Учебник по машинному обучению | Школа анализа данных](https://academy.yandex.ru/handbook/ml)

#### Материалы
* [Feature selection | Scikit-learn Documentation](https://scikit-learn.org/stable/modules/feature_selection.html)
* [Y. Gavrilova. Classification Algorithms: A Tomato-Inspired Overview | Serokell](https://serokell.io/blog/classification-algorithms)
